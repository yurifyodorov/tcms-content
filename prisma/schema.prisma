generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Run {
  id        String   @id @default(cuid())
  runNumber Int      @unique @default(autoincrement())
  status    String
  browser   String
  platform  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  duration  Int?
  auto      Boolean

  runFeatures  RunFeature[]
  runScenarios RunScenario[]
  runSteps     RunStep[]

  @@index([status])
  @@index([platform])
  @@index([createdAt])
  @@map("runs")
}

model Feature {
  id   String @id @default(cuid())
  name String @unique

  scenarioFeatures ScenarioFeature[]
  runFeatures      RunFeature[]

  @@map("features")
}

model Scenario {
  id     String @id @default(cuid())
  name   String
  status String

  scenarioFeatures ScenarioFeature[]
  scenarioSteps    ScenarioStep[]
  runScenarios     RunScenario[]

  @@unique([name])
  @@map("scenarios")
}

model Step {
  id     String     @id @default(cuid())
  name   String     @unique
  status StepStatus

  scenarioSteps ScenarioStep[]
  runSteps      RunStep[]

  @@map("steps")
}

enum StepStatus {
  passed
  failed
  skipped
}

model ScenarioFeature {
  id         String   @id @default(cuid())
  scenario   Scenario @relation(fields: [scenarioId], references: [id])
  scenarioId String
  feature    Feature  @relation(fields: [featureId], references: [id])
  featureId  String

  @@unique([scenarioId, featureId])
  @@map("scenario_features")
}

model RunFeature {
  id        String  @id @default(cuid())
  run       Run     @relation(fields: [runId], references: [id])
  runId     String
  feature   Feature @relation(fields: [featureId], references: [id])
  featureId String

  @@unique([runId, featureId])
  @@map("run_features")
}

model RunScenario {
  id         String   @id @default(cuid())
  run        Run      @relation(fields: [runId], references: [id])
  runId      String
  scenario   Scenario @relation(fields: [scenarioId], references: [id])
  scenarioId String

  @@unique([runId, scenarioId])
  @@map("run_scenarios")
}

model RunStep {
  id     String @id @default(cuid())
  run    Run    @relation(fields: [runId], references: [id])
  runId  String
  step   Step   @relation(fields: [stepId], references: [id])
  stepId String

  @@unique([runId, stepId])
  @@map("run_steps")
}

model ScenarioStep {
  id         String   @id @default(cuid())
  scenario   Scenario @relation(fields: [scenarioId], references: [id])
  scenarioId String
  step       Step     @relation(fields: [stepId], references: [id])
  stepId     String

  @@unique([scenarioId, stepId])
  @@map("scenario_steps")
}
